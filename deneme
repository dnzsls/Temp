import pandas as pd
from datetime import datetime, timedelta

def parse_time(time_str):
    time_str = time_str.strip()
    if not time_str:
        return None
    return datetime.strptime(time_str, "%H:%M")

def calculate_shift_duration(shift_range):
    shift_range = shift_range.strip()
    if not shift_range or "-" not in shift_range:
        return 0
    
    parts = shift_range.split("-")
    if len(parts) != 2:
        return 0
    
    start = parse_time(parts[0])
    end = parse_time(parts[1])
    
    if start is None or end is None:
        return 0
    
    if end <= start:
        end += timedelta(days=1)
    
    duration = (end - start).total_seconds() / 3600
    return duration

def analyze_shift(shift_str):
    # Boş/null → null döndür
    if pd.isna(shift_str) or str(shift_str).strip() == "":
        return None, None
    
    shift_str = str(shift_str).strip()
    segments = [s.strip() for s in shift_str.split("/") if s.strip()]
    
    if not segments:
        return None, None
    
    is_split = len(segments) > 1
    total_hours = sum(calculate_shift_duration(seg) for seg in segments)
    
    if total_hours == 0:
        return None, None
    
    if is_split:
        category = "F"
    elif total_hours >= 8:
        category = "N"
    else:
        category = "K"
    
    return round(total_hours, 2), category

# Uygula - kendi kolon adını yaz
df[["calisma_saati", "kategori"]] = df["vardiya"].apply(
    lambda x: pd.Series(analyze_shift(x))
)
